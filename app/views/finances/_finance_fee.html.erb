
<fieldset>
  <legend>付费信息：</legend>
  <% finance_fees = @finance.finance_fees %>
  <% is_empty  = finance_fees.empty? %>
  <% if is_empty  %>
      <% finance_fees =  EnterpriseFee.find_all_by_load_port_and_enterprise_id(@finance.declaration.load_port, @finance.declaration.enterprise_id) %>
  <% end %>
  <table>
    <thead>
    <tr>
      <th>编号</th>
      <th>中文名</th>
      <th>结算单位</th>
      <th>价格</th>
      <th>应收</th>
      <th>应付</th>
      <th>操作</th>
    </tr>
    </thead>
    <tfoot>

    </tfoot>
    <tbody>
    <% finance_fees.each do |finance_fee| %>
        <% if is_empty
             #new_finance_fee = FinanceFee.new(finance_fee.attributes.except!('enterprise_id'))
             new_finance_fee = FinanceFee.new(Dict::Fee.find_by_code(finance_fee.code).attributes)
             new_finance_fee.finance_id = @finance.id
             new_finance_fee.save
             finance_fee = new_finance_fee
           end %>
        <tr>
          <td><%= link_to finance_fee.code, finance_fee %></td>
          <td><%= finance_fee.name %></td>
          <% if finance_fee.checkout_enterprise %>
              <td><%= Enterprise.find_by_code(finance_fee.checkout_enterprise.code).name rescue '' %></td>
          <% else %>
              <% if @finance.review == 1 or   @finance.review == 3  %>
                  <td class="no_checkout_enterprise">&nbsp; <%# link_to "选择结算单位", edit_finance_fee_path(finance_fee, :from => @finance.id) %></td>
              <% else %>
                  <!--<td>已审核，不能操作</td>-->
                  <td>&nbsp;</td>
              <% end %>
          <% end %>
          <td><%= finance_fee.price %></td>
          <td><%= finance_fee.is_income ? '√' : '×' %></td>
          <td><%= finance_fee.is_pay ? '√' : '×' %></td>
          <td>
            <% if @finance.review == 1 or   @finance.review == 3  %>
                <%= link_to "修改", edit_finance_fee_path(finance_fee, :from => @finance.id) %>
                <%= link_to "删除", finance_fee_path(finance_fee) + "?from=" + @finance.id.to_s, confirm: '确定删除?', method: :delete %>
                <%= link_to "选择结算单位", edit_finance_fee_path(finance_fee, :from => @finance.id, :is_checkout => true) %>
        <% else %>
                已审核，不能操作
            <% end %>
          </td>
        </tr>
    <% end %>
    </tbody>
  </table>
  <% if @finance.review == 1 or   @finance.review == 3  %>
      <p>
        <%= link_to '新建付费信息', new_finance_fee_path(:finance_id =>  @finance.id, :from => @finance.id) %>
      </p>
  <% end %>

</fieldset>