<style type="text/css">
    @page {
        size:landscape;
    }
    body{
        font-size: 12px;
    }
    .frame {
        position:relative;
        top: 0px;
        left: 0px;
    }

    #theSeals{
        position:absolute;
        top:0px;
        left:0px;
    }

    td{
        padding: 0 0.5em;
    }
    .clear{
        page-break-after: always;
        clear: both;
    }

    .outer-center {
        float: right;
        right: 50%;
        position: relative;
    }
    .inner-center {
        float: right;
        right: -50%;
        position: relative;
    }

</style>
<div >
  <div class="outer-center">
    <div class="inner-center">
      <h2>
        <b>东莞市泽盛物流有限公司</b>
      </h2>
      <h5>
        <b>东莞市沙田镇港口大道保税物流中心保税大厦6楼</b><br/>
        TEL:0769-88861732&nbsp;&nbsp;FAX:0769-8880422<br/>
      </h5>
      <table class="frame">
        <tr>
          <td>户名：</td><td class="content"></td>
        </tr>
        <tr>
          <td>开户行：</td><td class="content"></td>
        </tr>
        <tr>
          <td>卡号：</td><td class="content"></td>
        </tr>
        <div id="theSeals">
          <div class='seal-div hideseals' style="display: none" title="拖动图片移动位置">
            <%= image_tag("seal1.png",  :alt => "印章", :class=>"seal", :id=>'seal_left',  :style=>"z-index:100;cursor:move")  %>
            <span class='delete_seals' title='删除图片' style="position: relative; left:-20px; z-index: 100; cursor: pointer;"><%= image_tag("icons/cross.png") %></span>
          </div>
        </div>
      </table>
      <table  border=1 style="border-collapse:collapse;">
        <thead style="font-weight: bold">
        <tr >
          <td>序号</td>
          <td>客户</td>
          <td>报关单日期</td>
          <td>进/出口</td>
          <td>报关单号</td>
          <% finance_fee_codes = [] %>
          <% @finance_declarations.each do |finance_declaration| %>
              <% finance_declaration.finances[0].finance_fees.each do |finance_fee| %>
                  <% fee = Dict::Fee.find_by_code(finance_fee.code) %>
                  <% if !finance_fee_codes.include?(finance_fee.code) and !fee.name.blank? %>
                      <td><%= fee.name %></td>
                      <% finance_fee_codes.append(finance_fee.code) %>
                  <% end %>
              <% end %>
          <% end %>
          <td>金额(RMB)</td>
        </tr>
        </thead>
        <tbody>
        <% col_total_prices = Array.new(finance_fee_codes.size + 1, 0) %>
        <% no = 0 %>
        <% @finance_declarations.each do |finance_declaration| %>
            <% finance = finance_declaration.finances[0] %>
            <% checkout_enterprises = finance.checkout_enterprises %>
            <% checkout_enterprises.each do |checkout_enterprise| %>
                <tr>
                  <td><%= no = no + 1 %></td>
                  <td><%= Enterprise.find_by_code(checkout_enterprise.code).name %></td>
                  <td><%= finance_declaration.declare_date %></td>
                  <td><%= Dict::DealMode.find_by_code(finance_declaration.deal_mode).name rescue '' %></td>
                  <td><%= finance_declaration.entry_no %></td>
                  <% i = 0 %>
                  <% row_total_price = 0 %>
                  <% if checkout_enterprises.size == 1 %>
                      <% checkout_enterprise_fees = finance.finance_fees %>
                <% else %>
                      <% checkout_enterprise_fees = checkout_enterprise.finance_fees %>
                  <% end %>
                  <% finance_fee_codes.each_with_index do |finance_fee_code,vi| %>
                      <% if i < checkout_enterprise_fees.size and finance_fee_code == checkout_enterprise_fees[i].code %>
                          <td><%= price =  Dict::Fee.find_by_code(finance_fee_code).price %></td>
                          <% i = i + 1 %>
                          <% row_total_price = row_total_price + price %>
                          <% col_total_prices[vi] = col_total_prices[vi] + price %>
                      <% else %>
                          <td> &nbsp; </td>
                      <% end %>
                  <% end %>
                  <td><%= row_total_price %></td>
                  <% col_total_prices[col_total_prices.size - 1] = col_total_prices[col_total_prices.size - 1] + row_total_price %>
                </tr>
            <% end %>
        <% end %>
        <% page_size  = 23 %>
        <% (page_size - @finance_declarations.size%page_size - 1).times do  %>
            <tr>
              <% (6 + finance_fee_codes.size).times do %>
                  <td>&nbsp;</td>
              <% end %>
            </tr>
        <% end %>
        <tr>
          <td></td>
          <td>合计</td>
          <td></td>
          <td></td>
          <td></td>
          <% col_total_prices.each do |col_total_price| %>
              <td><%= col_total_price %></td>
          <% end %>
        </tr>
        </tbody>
      </table>
    </div>
  </div>


</div>



